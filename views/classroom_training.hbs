<head>
	<link rel="stylesheet" type="text/css" href="/css/main.css">
	<link rel="stylesheet" type="text/css" href="/css/individual_training.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>



<div class="row">

    <div class="table-wrapper" style="width: 45%;  margin-right:1px auto">
        <div class="table-title">
            <h5 style="text-align: center;"><b>Task List</b></h5>
        </div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th style="width: 30%;">Task Name</th>
                    <th>Added by</th>
                    <th>Deadline</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {{#each task_list}}
                <tr>
                    <td>{{task_title}}</td>
                    <td><a href = "/profile/{{task_added_by_user_handle}}/" style="color: #5bc0de; font-weight:700;">{{task_added_by_user_handle}}</a></td>
                    <td>{{deadline}}</td>
                    <td>
                        <a href="/classroom/task/update/{{id}}/" title="Update" data-toggle="tooltip" style="color: #5bbbd3;"><i class="fas fa-edit"></i></a>
                        <a href="/classroom/task/delete/{{id}}/" title="Delete" data-toggle="tooltip" style="color: rgb(255, 124, 2);"><i class="fas fa-trash"></i></a>
                    </td>
                </tr>
                 {{/each}}

            </tbody>
        </table>
        <div class="add-task row">
            <div style="margin-right: 5px; margin-left:15px;">
                <a style="background-color: #8FC1e3;" title="Add new task" class='btn' href="/classroom/task/add/{{id}}/"><i class="fas fa-plus"></i></a>
            </div>
            <div >
                <a style="background-color: #8FC1e3;" title="View all tasks" class='btn' href="/classroom/task/view/{{id}}/"  style="margin: 30px;"><i class="fas fa-bars"></i></a>
            </div>
        </div>
    </div>

    <div class="table-wrapper" style="width: 45%;  margin-left:1px auto">
        <div class="table-title">
            <h5 style="text-align: center;"><b>Class List</b></h5>
        </div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th style="width: 25%;">Class Title</th>
                    <th>Moderator</th>
                    <th>Class Time</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {{#each class_list}}
                <tr>
                    <td>{{class_title}}</td>
                    <td><a href = "/profile/{{class_moderator_id_user_handle}}/" style="color: #5bc0de; font-weight:700;">{{class_moderator_id_user_handle}}</a></td>
                    <td>{{class_time}}</td>
                    <td>
                        <a href="/classroom/class/update/{{id}}/" title="Update" data-toggle="tooltip" style="color: #5bbbd3;"><i class="fas fa-edit"></i></a>
                        <a href="/classroom/class/delete/{{id}}/" title="Delete" data-toggle="tooltip" style="color: rgb(255, 124, 2);"><i class="fas fa-trash"></i></a>
                    </td>
                </tr>
                 {{/each}}

            </tbody>
        </table>
        <div class="add-task row">
            <div style="margin-right: 5px; margin-left:15px;">
                <a style="background-color: #8FC1e3;" title="Add new class" class='btn' href="/classroom/class/add/{{id}}/"><i class="fas fa-plus"></i></a>
            </div>
            <div >
                <a style="background-color: #8FC1e3;" title="View all class" class='btn' href="/classroom/class/view/{{id}}/"  style="margin: 30px;"><i class="fas fa-bars"></i></a>
            </div>
        </div>
    </div>
</div>


<div class="table-type-1">
    <div class="table-title-2">
        <h5 style="text-align: center;"><b>Classroom Members</b></h5>
    </div>
    <table id="memberTable" class="table table-striped table-bordered category-list-table">
        <thead style="background-color: #ACCBE1;">
            <tr>
                <th style="min-width: 13%;">User Handle</th>
                <th>Name</th>
                <th>Skill Value</th>
                <th>Skill Title</th>
                <th>Solve Count</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</div>


<div class="table-type-1">
    <div class="table-title-2">
        <h5 style="text-align: center;"><b>Category Wise Skills</b></h5>
    </div>
    <table id="categoryWiseSkillTable" class="table table-striped table-bordered category-list-table">
        <thead style="background-color: #ACCBE1;">
            <tr>
                <th style="min-width: 13%;">User Handle</th>
                {{#each category_list}}
                    <th>{{short_name}}</th>
                {{/each}}
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</div>

<div class="table-type-1">
    <div class="table-title-2">
        <h5 style="text-align: center;"><b>Category Solve Count</b></h5>
    </div>
    <table id="categoryWiseSolveCountTable" class="table table-striped table-bordered category-list-table">
        <thead style="background-color: #ACCBE1;">
            <tr>
                <th style="width: 13%;">User Handle</th>
                {{#each category_list}}
                    <th>{{short_name}}</th>
                {{/each}}
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</div>


<div class="table-type-1">
    <div class="table-title-2">
        <h5 style="text-align: center;"><b>Training Contest List</b></h5>
    </div>
    <table id="contestListTable" class="table table-striped table-bordered">
        <thead style="background-color: #ACCBE1;">
            <tr>
                <th style="min-width: 20%;">Contest Name</th>
                <th>Setter</th>
                <th>Contest Type</th>
                <th>Contest Level</th>
                <th>Description</th>
                <th>Start Date</th>
                <th>End Date</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>


<script type="text/javascript">

    function getMemberTableList(){
        var data_list = [];

        var classroom_id = "{{id}}"
        var team_lead_id = "{{team_leader_id}}"
        var logger_in_user = "{{session.user_id}}"

        console.log('team_lead_id: ' + team_lead_id)
        console.log('logger_in_user: ' + logger_in_user)

        {{#each member_list}}
            var member_id = "{{id}}"
            console.log('member_id: ' + member_id)
            var user_name = '<a href = "/profile/{{user_handle}}/" style="color: #5bc0de; font-weight:700;">{{user_handle}} ({{status}})</a>'
            var action_delete = ''
            
            if(logger_in_user == team_lead_id){
                if(logger_in_user != member_id){
                    action_delete = '<a href="/classroom/member/delete/'+classroom_id+'/{{user_handle}}/" title="Delete member" data-toggle="tooltip" style="color: rgb(255, 124, 2);"><i class="fas fa-trash"></i></a>'
                }
            }else if(logger_in_user == member_id){
                action_delete = '<a href="/classroom/member/delete/'+classroom_id+'/{{user_handle}}/" title="Leave team" data-toggle="tooltip" style="color: rgb(255, 124, 2);"><i class="fas fa-trash"></i></a>'
            }
            
            data = [user_name, "{{full_name}}", "{{skill_value}}", "{{skill_title}}", "{{solve_count}}", action_delete]
            data_list.push(data)
        {{/each}}

        return data_list;
    }

    function getCategoryWiseSkillList(){
        var data_list = [];
        {{#each member_stat}}
            var cur_member_data = ["{{user_handle}}"]
            {{#each skill_list}}
                var skill_value = parseFloat("{{skill_value}}")
                var skill_value_final = skill_value.toFixed(2);
                cur_member_data.push(skill_value_final)
            {{/each}}
            console.log(cur_member_data)
            data_list.push(cur_member_data)
        {{/each}}
        return data_list
    }

    function getCategoryWiseSolveCountList(){
        var data_list = [];
        {{#each member_stat}}
            var cur_member_data = ["{{user_handle}}"]
            {{#each skill_list}}
                var solve_count = parseFloat("{{solve_count}}")
                cur_member_data.push(solve_count)
            {{/each}}
            console.log(cur_member_data)
            data_list.push(cur_member_data)
        {{/each}}
        return data_list
    }


    function getTaskList(){
        var current_user = "{{logged_in_user_id}}"
        var team_lead = "{{team_leader_id}}"
        console.log("current_user")
        console.log(current_user)

        var db_task_list = [];

        {{#each task_list}}
            var action_link = '<div class = "display: flex; align-items: center; justify-content: center;">'
            if(current_user == team_lead){
                action_link += '<a href="/classroom/delete/{{id}}/" title="Delete" data-toggle="tooltip" style="color: #c40b00;"><i class="fas fa-trash"></i></a>'
                action_link += '<a href="/classroom/reject/{{id}}/" title="Remove" data-toggle="tooltip" style="color: #f8b317;"><i class="fas fa-minus-circle"></i></a>'
            }else{
                action_link += '<a href="/classroom/reject/{{id}}/" title="Remove" data-toggle="tooltip" style="color: #f8b317;"><i class="fas fa-minus-circle"></i></a>'
            }
            action_link += "</div>"

            var task_data = ["{{task_title}}", "{{task_description}}", "{{task_added_by_user_handle}}", "{{deadline}}", "{{status}}", action_link];
            db_task_list.push(task_data)
        {{/each}}

        return db_task_list;
    }

    function showTaskListDTSearchTable(){
        var dt_list = getTaskList();
        
        $("#taskListTable").dataTable({
            "aaData": dt_list,
            paging: true,
            destroy: true,
            scrollCollapse: true,
            responsive: true,
            pageLength: 10,
            lengthMenu: [[3, 5, 10, -1], [3, 5, 10, 20]]
        });
    }

    function showMemberTable(){
        var dt_list = getMemberTableList();
        
        $("#memberTable").dataTable({
            "aaData": dt_list,
            paging: false,
            pageLength: 100,
            destroy: true,
            scrollY: '1000px',
            scrollCollapse: true
        });
    }

    function showCategoryWiseSkillTable(){
        var dt_list = getCategoryWiseSkillList();
        
        $("#categoryWiseSkillTable").dataTable({
            "aaData": dt_list,
            paging: false,
            pageLength: 100,
            destroy: true,
            scrollY: '1000px',
            scrollCollapse: true
        });
    }

    function showCategoryWiseSolveCountTable(){
        var dt_list = getCategoryWiseSolveCountList();
        
        $("#categoryWiseSolveCountTable").dataTable({
            "aaData": dt_list,
            paging: true,
            destroy: true,
            responsive: true,
            scrollCollapse: true
        });
    }

    function getContestList(){
        var data_list = [];
        {{#each contest_list}}
            var contest_link = '<a href = "/contest/view/{{id}}/" style="color: #818101; font-weight:700;">{{contest_name}}</a>'
            var setter_link = '<div class = "display: flex; align-items: center; justify-content: center;">'
            setter_link += '<a href = "/profile/{{setter_handle}}/" style="color: #5bc0de; font-weight:700;">{{setter_handle}}</a>'
            setter_link += "</div>"
            var data = [contest_link, setter_link, "{{contest_type}}", "{{contest_level}}", "{{description}}", "{{start_date}}", "{{end_date}}"];
            data_list.push(data)
        {{/each}}
        return data_list;
    }

    function showContestsDTSearchTable(){
        var dt_list = getContestList();
        
        $("#contestListTable").dataTable({
            "aaData": dt_list,
            paging: false,
            destroy: true,
            scrollCollapse: true,
            responsive: true,
            pageLength: 100
        });
    }
    
    showMemberTable()
    showCategoryWiseSkillTable()
    showTaskListDTSearchTable()
    showCategoryWiseSolveCountTable()
    showContestsDTSearchTable();

</script>